<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <script src="../JS/canvasjs-2.2/canvasjs.min.js"></script>
        <title>Document</title>
        <style>
            body {
                color: white;
                background-color: black;
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }
            div {
                height: 50vh;
                text-align: center;
                font-size: 5vh;
            }
            h1#count {
                font-size: 10vh;
            }
        </style>
        <script>
            var count = '';
            function compareDataPointYAscend(dataPoint1, dataPoint2) {
                return dataPoint1.y - dataPoint2.y;
            }

            function compareDataPointYDescend(dataPoint1, dataPoint2) {
                return dataPoint2.y - dataPoint1.y;
            }

            function changeNumber(number) {
                var a = document.getElementById('count');
                console.log(number);
                
                number = number
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                a.innerText = number;
            }
            function updateNumber(file) {
                fetch(file)
                    .then(response => response.text())
                    .then(text => changeNumber(text)) // Mandar o comando por aqui
            };
            function getFromBottle(url) {
                return [
                    {
                        y: 80,
                        label: "Sweden"
                    }, {
                        y: 808,
                        label: "Taiwan"
                    }, {
                        y: 908,
                        label: "Russia"
                    }, {
                        y: 108,
                        label: "Spain"
                    }, {
                        y: 203,
                        label: "Brazil"
                    }
                ]
            }
            function getData(url) {
                return [
                    {
                        type: "bar",
                        name: "Países",
                        axisYType: "secondary",
                        color: "#014D65",
                        dataPoints: getFromBottle(url)
                    }
                ]
            }
            window.setInterval(function () {
                updateNumber('../XML/TotalAttacks.txt')
            }, 500);
        </script>
    </head>
    <body>
        <div class="body-wrapper">
            <div>Ataques bloqueados apartir de las 0 Hrs.<h1 id="count">0</h1>
            </div>
            <div class="bar-graph" id="paises"></div>
        </div>
        <script>
            window.onload = function () {

                var chart = new CanvasJS.Chart("paises", {
                    animationEnabled: false,
                    backgroundColor: "black",
                    theme: 'dark2',

                    title: {
                        text: "Países realizando ataques al Tecnológico de Monterrey"
                    },
                    axisX: {
                        interval: 1
                    },
                    axisY: {
                        interval: 20
                    },
                    axisY2: {
                        interlacedColor: "rgba(1,77,101,.2)",
                        gridColor: "rgba(1,77,101,.1)",
                        title: "Número de Ataques"
                    },
                    data: getData('url')
                });
                chart
                    .options
                    .data[0]
                    .dataPoints
                    .sort(compareDataPointYAscend);
                chart.render();
            }
        </script>
    </body>
</html>